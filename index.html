<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CineSlate</title>

<style>
:root {
  --bg: #0b0b0e;
  --card: #17171c;
  --muted: #9ca3af;
  --accent: #e5e7eb;
}

body {
  margin: 0;
  background: var(--bg);
  color: white;
  font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
}

.container {
  max-width: 430px;
  margin: auto;
  padding: 16px;
}

h1 {
  font-size: 22px;
  margin-bottom: 12px;
}

label {
  font-size: 12px;
  color: var(--muted);
  margin-top: 10px;
  display: block;
}

input, select, textarea {
  width: 100%;
  padding: 10px;
  margin-top: 4px;
  border-radius: 10px;
  border: none;
  background: var(--card);
  color: white;
}

textarea { resize: vertical; }

button {
  border: none;
  border-radius: 10px;
  padding: 10px;
  background: var(--accent);
  color: black;
  font-weight: 600;
  cursor: pointer;
}

button.secondary {
  background: #27272a;
  color: white;
  font-weight: 500;
}

.section {
  margin-top: 18px;
}

.shot {
  background: var(--card);
  padding: 12px;
  border-radius: 14px;
  margin-top: 12px;
}

.shot-header {
  font-weight: 600;
}

.meta {
  font-size: 13px;
  color: var(--muted);
  margin-top: 4px;
}

.actions {
  display: flex;
  gap: 6px;
  margin-top: 8px;
}

.actions button {
  padding: 6px 8px;
  font-size: 13px;
}

.drag {
  cursor: grab;
}

.divider {
  height: 1px;
  background: #27272a;
  margin: 16px 0;
}
</style>
</head>

<body>
<div class="container">

<h1>CineSlate</h1>

<label>Film</label>
<select id="filmSelect"></select>
<input id="newFilm" placeholder="New film name">
<button onclick="addFilm()">Add / Switch Film</button>
<button class="secondary" onclick="deleteFilm()">Delete Film</button>

<div class="divider"></div>

<div class="section">
<label>Shot Description</label>
<input id="shotDesc" placeholder="INT. HALLWAY – TRACKING">

<label>Shot Type</label>
<select id="shotType"></select>
<input id="newShotType" placeholder="Add shot type">

<label>Actors</label>
<select id="actors"></select>
<input id="newActor" placeholder="Add actor">

<label>Crew</label>
<select id="crew"></select>
<input id="newCrew" placeholder="Add crew">

<label>Location</label>
<select id="location"></select>
<input id="newLocation" placeholder="Add location">

<label>Notes</label>
<textarea id="notes"></textarea>

<button onclick="addShot()">Add Shot</button>
</div>

<div class="divider"></div>

<div id="shotList"></div>

</div>

<script>
let state = JSON.parse(localStorage.getItem("cineslate_clean")) || {
  films: {},
  current: null,
  shotTypes: [],
  actors: [],
  crew: [],
  locations: []
};

function save() {
  localStorage.setItem("cineslate_clean", JSON.stringify(state));
  render();
}

function $(id) { return document.getElementById(id); }

function ensureFilm() {
  if (!state.current) return [];
  if (!state.films[state.current]) state.films[state.current] = [];
  return state.films[state.current];
}

/* Film controls */
function addFilm() {
  const name = $("newFilm").value || $("filmSelect").value;
  if (!name) return;
  if (!state.films[name]) state.films[name] = [];
  state.current = name;
  $("newFilm").value = "";
  save();
}

function deleteFilm() {
  if (!state.current) return;
  if (confirm("Delete this entire film?")) {
    delete state.films[state.current];
    state.current = null;
    save();
  }
}

/* Dropdown helpers */
function addUnique(list, value) {
  if (value && !list.includes(value)) list.push(value);
}

function addShot() {
  if (!$("shotDesc").value) return;

  addUnique(state.shotTypes, $("newShotType").value);
  addUnique(state.actors, $("newActor").value);
  addUnique(state.crew, $("newCrew").value);
  addUnique(state.locations, $("newLocation").value);

  ensureFilm().push({
    id: Date.now(),
    desc: $("shotDesc").value,
    type: $("shotType").value,
    actor: $("actors").value,
    crew: $("crew").value,
    location: $("location").value,
    notes: $("notes").value
  });

  ["shotDesc","notes","newShotType","newActor","newCrew","newLocation"].forEach(id => $(id).value = "");
  save();
}

/* Render */
function render() {
  $("filmSelect").innerHTML = Object.keys(state.films)
    .map(f => `<option ${f===state.current?"selected":""}>${f}</option>`)
    .join("");

  ["shotType","actors","crew","location"].forEach((id, i) => {
    const list = [state.shotTypes,state.actors,state.crew,state.locations][i];
    $(id).innerHTML = list.map(v => `<option>${v}</option>`).join("");
  });

  const list = $("shotList");
  list.innerHTML = "";

  ensureFilm().forEach((s, i) => {
    const d = document.createElement("div");
    d.className = "shot drag";
    d.draggable = true;
    d.innerHTML = `
      <div class="shot-header">${i+1}. ${s.desc}</div>
      <div class="meta">${s.type} • ${s.actor} • ${s.crew} • ${s.location}</div>
      <div class="meta">${s.notes || ""}</div>
      <div class="actions">
        <button onclick="removeShot(${i})">Delete</button>
      </div>
    `;
    d.ondragstart = e => e.dataTransfer.setData("i", i);
    d.ondragover = e => e.preventDefault();
    d.ondrop = e => {
      const from = e.dataTransfer.getData("i");
      const shots = ensureFilm();
      shots.splice(i, 0, shots.splice(from, 1)[0]);
      save();
    };
    list.appendChild(d);
  });
}

function removeShot(i) {
  ensureFilm().splice(i, 1);
  save();
}

$("filmSelect").onchange = () => {
  state.current = $("filmSelect").value;
  save();
};

save();
</script>
</body>
</html>
