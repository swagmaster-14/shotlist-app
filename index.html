<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CineSlate</title>

<style>
:root {
  --bg: #0f1115;
  --card: #1b1e25;
  --muted: #9ca3af;
  --accent: #ffffff;
}

body {
  margin: 0;
  background: var(--bg);
  color: white;
  font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
}

.container {
  max-width: 420px;
  margin: auto;
  padding: 16px;
}

h1 {
  font-size: 22px;
  margin-bottom: 12px;
}

label {
  font-size: 12px;
  color: var(--muted);
  margin-top: 12px;
  display: block;
}

input, select, textarea {
  width: 100%;
  margin-top: 6px;
  padding: 10px;
  border-radius: 10px;
  border: none;
  background: var(--card);
  color: white;
}

textarea {
  resize: vertical;
}

button {
  width: 100%;
  margin-top: 12px;
  padding: 12px;
  border-radius: 12px;
  border: none;
  background: var(--accent);
  color: black;
  font-weight: 600;
  cursor: pointer;
}

button.secondary {
  background: #2a2e39;
  color: white;
}

.divider {
  height: 1px;
  background: #2a2e39;
  margin: 20px 0;
}

/* Shot cards */
.shot {
  background: var(--card);
  padding: 14px;
  border-radius: 14px;
  margin-top: 12px;
}

.shot-title {
  font-weight: 600;
}

.shot-meta {
  font-size: 13px;
  color: var(--muted);
  margin-top: 4px;
}

.shot-notes {
  font-size: 13px;
  margin-top: 6px;
}

.shot-actions {
  display: flex;
  gap: 8px;
  margin-top: 10px;
}

.shot-actions button {
  width: auto;
  padding: 6px 10px;
  font-size: 12px;
}

.drag {
  cursor: grab;
}
</style>
</head>

<body>
<div class="container">

<h1>CineSlate</h1>

<!-- Film -->
<label>Film</label>
<select id="filmSelect"></select>
<input id="newFilm" placeholder="New film name">
<button onclick="addFilm()">Add / Switch Film</button>
<button class="secondary" onclick="deleteFilm()">Delete Film</button>

<div class="divider"></div>

<!-- Shot form -->
<label>Shot Description</label>
<input id="desc" placeholder="INT. HALLWAY – TRACKING">

<label>Shot Type</label>
<select id="shotType"></select>
<input id="newShotType" placeholder="Add shot type (e.g. CU, Wide)">

<label>Actors</label>
<input id="actors" placeholder="Actor names">

<label>Crew</label>
<input id="crew" placeholder="DP / Operator / Sound">

<label>Location</label>
<select id="location"></select>
<input id="newLocation" placeholder="Add location">

<label>Notes</label>
<textarea id="notes"></textarea>

<button onclick="addShot()">Add Shot</button>

<div class="divider"></div>

<!-- Shot list -->
<div id="shotList"></div>

</div>

<script>
/* ---------- STATE ---------- */
let app = JSON.parse(localStorage.getItem("cineslate_v2")) || {
  films: {},
  currentFilm: null,
  shotTypes: ["Wide", "Medium", "CU"],
  locations: []
};

/* ---------- HELPERS ---------- */
function $(id) { return document.getElementById(id); }

function save() {
  localStorage.setItem("cineslate_v2", JSON.stringify(app));
  render();
}

function currentShots() {
  if (!app.currentFilm) return [];
  if (!app.films[app.currentFilm]) app.films[app.currentFilm] = [];
  return app.films[app.currentFilm];
}

/* ---------- FILMS ---------- */
function addFilm() {
  const name = $("newFilm").value || $("filmSelect").value;
  if (!name) return;
  if (!app.films[name]) app.films[name] = [];
  app.currentFilm = name;
  $("newFilm").value = "";
  save();
}

function deleteFilm() {
  if (!app.currentFilm) return;
  if (!confirm("Delete this entire film?")) return;
  delete app.films[app.currentFilm];
  app.currentFilm = null;
  save();
}

/* ---------- SHOTS ---------- */
function addShot() {
  if (!$("desc").value || !app.currentFilm) return;

  if ($("newShotType").value && !app.shotTypes.includes($("newShotType").value)) {
    app.shotTypes.push($("newShotType").value);
  }

  if ($("newLocation").value && !app.locations.includes($("newLocation").value)) {
    app.locations.push($("newLocation").value);
  }

  currentShots().push({
    id: Date.now(),
    desc: $("desc").value,
    type: $("shotType").value,
    actors: $("actors").value,
    crew: $("crew").value,
    location: $("location").value,
    notes: $("notes").value
  });

  ["desc","actors","crew","notes","newShotType","newLocation"].forEach(id => $(id).value = "");
  save();
}

function deleteShot(index) {
  currentShots().splice(index, 1);
  save();
}

/* ---------- RENDER ---------- */
function render() {
  // Films
  $("filmSelect").innerHTML = Object.keys(app.films)
    .map(f => `<option ${f === app.currentFilm ? "selected" : ""}>${f}</option>`)
    .join("");

  // Dropdowns
  $("shotType").innerHTML = app.shotTypes.map(t => `<option>${t}</option>`).join("");
  $("location").innerHTML = app.locations.map(l => `<option>${l}</option>`).join("");

  // Shots
  const list = $("shotList");
  list.innerHTML = "";

  currentShots().forEach((s, i) => {
    const div = document.createElement("div");
    div.className = "shot drag";
    div.draggable = true;

    div.innerHTML = `
      <div class="shot-title">${i + 1}. ${s.desc}</div>
      <div class="shot-meta">${s.type} • ${s.location}</div>
      <div class="shot-meta">Actors: ${s.actors || "-"}</div>
      <div class="shot-meta">Crew: ${s.crew || "-"}</div>
      <div class="shot-notes">${s.notes || ""}</div>
      <div class="shot-actions">
        <button class="secondary" onclick="deleteShot(${i})">Delete</button>
      </div>
    `;

    div.ondragstart = e => e.dataTransfer.setData("from", i);
    div.ondragover = e => e.preventDefault();
    div.ondrop = e => {
      const from = e.dataTransfer.getData("from");
      const shots = currentShots();
      shots.splice(i, 0, shots.splice(from, 1)[0]);
      save();
    };

    list.appendChild(div);
  });
}

$("filmSelect").onchange = () => {
  app.currentFilm = $("filmSelect").value;
  save();
};

save();
</script>
</body>
</html>
