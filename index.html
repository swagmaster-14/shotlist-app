<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CineSlate</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="theme-color" content="#09090b">

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
      background: #09090b;
      color: #fafafa;
    }
    .container {
      max-width: 420px;
      margin: auto;
      padding: 16px;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 12px;
    }
    input, textarea, select {
      width: 100%;
      margin-bottom: 8px;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: #27272a;
      color: white;
    }
    button {
      padding: 6px 8px;
      border-radius: 6px;
      border: none;
      background: #3f3f46;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }
    button.primary {
      width: 100%;
      background: white;
      color: black;
      font-weight: bold;
      margin-bottom: 12px;
    }
    button.icon {
      background: #27272a;
      font-size: 16px;
    }
    button.icon:hover::after {
      content: attr(data-label);
      position: absolute;
      background: #18181b;
      color: white;
      padding: 4px 6px;
      border-radius: 4px;
      font-size: 11px;
      margin-top: -28px;
    }
    .shot {
      background: #18181b;
      padding: 12px;
      border-radius: 10px;
      margin-top: 10px;
    }
    .actions {
      margin-top: 8px;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    .status {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 6px;
      display: inline-block;
      margin-top: 6px;
      cursor: pointer;
    }
    .planned { background: #3f3f46; }
    .shotdone { background: #16a34a; }
  </style>
</head>
<body>
<div class="container">
  <h1>CineSlate</h1>

  <select id="project"></select>
  <input id="newProject" placeholder="Film Name">
  <button class="primary" id="addProject">Add / Switch Film</button>

  <input id="shot" placeholder="Scene">
  <input id="type" placeholder="Shot Type(s)">
  <input id="actors" placeholder="Actors">
  <input id="location" placeholder="Location">
  <textarea id="notes" placeholder="Additional Notes"></textarea>

  <button class="primary" id="addShot">Add Shot</button>

  <div id="shots"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  let data = JSON.parse(localStorage.getItem("shotlist-data")) || { projects: {}, current: null };

  const projectSelect = document.getElementById("project");
  const newProjectInput = document.getElementById("newProject");
  const addProjectBtn = document.getElementById("addProject");

  const shotInput = document.getElementById("shot");
  const typeInput = document.getElementById("type");
  const actorsInput = document.getElementById("actors");
  const locationInput = document.getElementById("location");
  const notesInput = document.getElementById("notes");
  const shotsDiv = document.getElementById("shots");
  const addShotBtn = document.getElementById("addShot");

  let editingId = null;

  function save() {
    localStorage.setItem("shotlist-data", JSON.stringify(data));
    render();
  }

  function ensureProject() {
    if (!data.current) return [];
    if (!data.projects[data.current]) data.projects[data.current] = [];
    return data.projects[data.current];
  }

  function addProject() {
    const name = newProjectInput.value.trim() || projectSelect.value;
    if (!name) return;
    if (!data.projects[name]) data.projects[name] = [];
    data.current = name;
    newProjectInput.value = "";
    save();
  }

  function addShot() {
    if (!shotInput.value || !typeInput.value) return;
    const shots = ensureProject();

    if (editingId) {
      const s = shots.find(s => s.id === editingId);
      Object.assign(s, {
        shot: shotInput.value,
        type: typeInput.value,
        actors: actorsInput.value,
        location: locationInput.value,
        notes: notesInput.value
      });
      editingId = null;
      addShotBtn.textContent = "Add Shot";
    } else {
      shots.push({
        id: Date.now(),
        shot: shotInput.value,
        type: typeInput.value,
        actors: actorsInput.value,
        location: locationInput.value,
        notes: notesInput.value,
        status: "Planned"
      });
    }

    shotInput.value = typeInput.value = actorsInput.value = locationInput.value = notesInput.value = "";
    save();
  }

  function render() {
    projectSelect.innerHTML = Object.keys(data.projects)
      .map(p => `<option ${p === data.current ? "selected" : ""}>${p}</option>`)
      .join("");

    const shots = ensureProject();
    shotsDiv.innerHTML = "";

    shots.forEach((s, i) => {
      shotsDiv.innerHTML += `
        <div class="shot">
          <strong>${i + 1}. ${s.shot}</strong><br>
          Type: ${s.type}<br>
          Actors: ${s.actors || "-"}<br>
          Location: ${s.location || "-"}<br>
          <small>${s.notes || ""}</small><br>
          <div class="status ${s.status === "Shot" ? "shotdone" : "planned"}">${s.status}</div>
          <div class="actions">
            <button class="icon" data-edit="${s.id}" data-label="Edit">‚úèÔ∏è</button>
            <button class="icon" data-dup="${s.id}" data-label="Duplicate">üìÑ</button>
            <button class="icon" data-del="${s.id}" data-label="Delete">üóë</button>
            <button class="icon" data-up="${i}" data-label="Move up">‚¨ÜÔ∏è</button>
            <button class="icon" data-down="${i}" data-label="Move down">‚¨áÔ∏è</button>
          </div>
        </div>`;
    });

    document.querySelectorAll("[data-edit]").forEach(b => b.onclick = () => {
      const s = ensureProject().find(x => x.id == b.dataset.edit);
      if (!s) return;
      shotInput.value = s.shot;
      typeInput.value = s.type;
      actorsInput.value = s.actors;
      locationInput.value = s.location;
      notesInput.value = s.notes;
      editingId = s.id;
      addShotBtn.textContent = "Save Changes";
    });

    document.querySelectorAll("[data-del]").forEach(b => b.onclick = () => {
      data.projects[data.current] = ensureProject().filter(x => x.id != b.dataset.del);
      save();
    });

    document.querySelectorAll("[data-dup]").forEach(b => b.onclick = () => {
      const s = ensureProject().find(x => x.id == b.dataset.dup);
      if (!s) return;
      ensureProject().push({ ...s, id: Date.now() });
      save();
    });

    document.querySelectorAll("[data-up]").forEach(b => b.onclick = () => {
      const shots = ensureProject();
      const i = Number(b.dataset.up);
      if (i > 0) [shots[i - 1], shots[i]] = [shots[i], shots[i - 1]];
      save();
    });

    document.querySelectorAll("[data-down]").forEach(b => b.onclick = () => {
      const shots = ensureProject();
      const i = Number(b.dataset.down);
      if (i < shots.length - 1) [shots[i + 1], shots[i]] = [shots[i], shots[i + 1]];
      save();
    });

    document.querySelectorAll(".status").forEach((el, idx) => el.onclick = () => {
      const shots = ensureProject();
      shots[idx].status = shots[idx].status === "Planned" ? "Shot" : "Planned";
      save();
    });
  }

  addProjectBtn.onclick = addProject;
  addShotBtn.onclick = addShot;
  projectSelect.onchange = () => { data.current = projectSelect.value; save(); };

  render();
});
</script>
</body>
</html>
